// lib/utils.ts

/**
 * Formats a date string into a human-readable format
 * @param dateString - The date string to format (ISO format or similar)
 * @param options - Optional formatting options
 * @returns Formatted date string
 */
export function formatDate(
    dateString: string | null | undefined,
    options: Intl.DateTimeFormatOptions = {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    }
  ): string {
    if (!dateString) return 'Never';
    
    try {
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return 'Invalid date';
      
      return new Intl.DateTimeFormat('en-US', options).format(date);
    } catch (error) {
      console.error('Error formatting date:', error);
      return 'Invalid date';
    }
  }
  
  /**
   * Truncates text to a specified length and adds ellipsis if needed
   * @param text - The text to truncate
   * @param length - Maximum length before truncation
   * @returns Truncated text
   */
  export function truncateText(text: string, length: number = 50): string {
    if (!text) return '';
    return text.length > length ? `${text.substring(0, length)}...` : text;
  }
  
  /**
   * Capitalizes the first letter of a string
   * @param str - The string to capitalize
   * @returns Capitalized string
   */
  export function capitalize(str: string): string {
    if (!str) return '';
    return str.charAt(0).toUpperCase() + str.slice(1);
  }
  
  /**
   * Converts a string to title case
   * @param str - The string to convert
   * @returns Title-cased string
   */
  export function toTitleCase(str: string): string {
    if (!str) return '';
    return str.replace(
      /\w\S*/g,
      (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
    );
  }
  
  /**
   * Generates initials from a name
   * @param name - The full name
   * @returns Initials (max 2 characters)
   */
  export function getInitials(name: string): string {
    if (!name) return '';
    const names = name.split(' ');
    let initials = names[0].substring(0, 1).toUpperCase();
    
    if (names.length > 1) {
      initials += names[names.length - 1].substring(0, 1).toUpperCase();
    }
    
    return initials;
  }
  
  /**
   * Checks if a value is empty (null, undefined, empty string/array/object)
   * @param value - The value to check
   * @returns True if empty, false otherwise
   */
  export function isEmpty(value: any): boolean {
    if (value === null || value === undefined) return true;
    if (typeof value === 'string' && value.trim() === '') return true;
    if (Array.isArray(value) && value.length === 0) return true;
    if (typeof value === 'object' && Object.keys(value).length === 0) return true;
    return false;
  }
  
  /**
   * Debounces a function to limit how often it's called
   * @param func - The function to debounce
   * @param wait - Wait time in milliseconds
   * @returns Debounced function
   */
  export function debounce<T extends (...args: any[]) => any>(
    func: T,
    wait: number
  ): (...args: Parameters<T>) => void {
    let timeout: NodeJS.Timeout;
    return (...args: Parameters<T>): void => {
      clearTimeout(timeout);
      timeout = setTimeout(() => func(...args), wait);
    };
  }
  
  /**
   * Generates a random hex color
   * @returns Random hex color string
   */
  export function getRandomColor(): string {
    return `#${Math.floor(Math.random() * 16777215).toString(16)}`;
  }
  
  /**
   * Formats a number with commas as thousands separators
   * @param num - The number to format
   * @returns Formatted number string
   */
  export function formatNumber(num: number): string {
    return new Intl.NumberFormat('en-US').format(num);
  }
  
  /**
   * Checks if two arrays are equal (shallow comparison)
   * @param a - First array
   * @param b - Second array
   * @returns True if arrays are equal
   */
  export function arraysEqual(a: any[], b: any[]): boolean {
    if (a === b) return true;
    if (a == null || b == null) return false;
    if (a.length !== b.length) return false;
  
    for (let i = 0; i < a.length; ++i) {
      if (a[i] !== b[i]) return false;
    }
    return true;
  }